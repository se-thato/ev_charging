{% extends 'VoltHub/base.html' %}

{% block title %}Post Details - VoltHub{% endblock %}

{% block content %}
  <h1>{{ post.title }}</h1>
  <p>{{ post.content }}</p>
  <p>By {{ post.author.username }} on {{ post.created_at }}</p>

  <h2>Comments</h2>

  <form method="POST">
      {% csrf_token %}
      {{ form.as_p|default:'' }}
      {% if not form %}
        <div class="mb-3">
          <textarea name="comment_text" rows="3" class="form-control" placeholder="Write your comment here..."></textarea>
        </div>
      {% endif %}
      <button type="submit" class="btn btn-primary">Add Comment</button>
  </form>

  <ul>
      {% for comment in comments %}
          <li>
              <div>
                <strong>{{ comment.user.username }}</strong>: {{ comment.comment_text }} ({{ comment.created_at }})
              </div>
              <div class="mt-1" style="display:flex; gap:.5rem; align-items:center;">
                <form method="post" action="/comments/{{ comment.id }}/upvote/">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-success">
                    <i class="fa fa-thumbs-up"></i> {{ comment.upvotes }}
                  </button>
                </form>
                <form method="post" action="/comments/{{ comment.id }}/downvote/">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-danger">
                    <i class="fa fa-thumbs-down"></i> {{ comment.downvotes }}
                  </button>
                </form>
                <span class="badge bg-secondary">Score: {{ comment.total_votes }}</span>
              </div>
          </li>
      {% empty %}
          <li>No comments yet.</li>
      {% endfor %}
  </ul>

  <a href="/" class="btn btn-link">Back to Home</a>
{% endblock %}